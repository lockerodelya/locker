<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odelya Locker - User Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ====== EXISTING STYLES (KEEP ALL PREVIOUS STYLES) ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        .header {
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 5px;
        }

        /* ====== NEW ADMIN SECRET BUTTON ====== */
        .admin-secret-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ff9800;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        .admin-secret-btn:hover {
            opacity: 1;
        }

        /* ====== ADMIN MODAL ====== */
        .admin-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }

        .admin-modal {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            animation: modalFadeIn 0.3s ease;
        }

        .admin-modal-header {
            background: linear-gradient(135deg, #333 0%, #555 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .admin-modal-header h3 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s;
        }

        .admin-close-modal:hover {
            color: #ff9800;
        }

        /* ====== ADMIN CONTENT ====== */
        .admin-content {
            padding: 30px;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }

        .admin-tab-btn {
            background: #f5f5f5;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-tab-btn:hover {
            background: #e0e0e0;
        }

        .admin-tab-btn.active {
            background: #2196f3;
            color: white;
        }

        /* ====== USER MANAGEMENT SECTION ====== */
        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .user-form-section {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #2196f3;
        }

        .form-title {
            color: #1a237e;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .admin-form-group {
            display: flex;
            flex-direction: column;
        }

        .admin-form-group label {
            margin-bottom: 8px;
            color: #424242;
            font-weight: 500;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-form-group input,
        .admin-form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .admin-form-group input:focus,
        .admin-form-group select:focus {
            border-color: #2196f3;
            outline: none;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .admin-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-admin-save {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .btn-admin-save:hover {
            background: linear-gradient(135deg, #388e3c 0%, #1b5e20 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-admin-clear {
            background: #f5f5f5;
            color: #666;
            border: 2px solid #e0e0e0;
            padding: 14px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .btn-admin-clear:hover {
            background: #e0e0e0;
        }

        /* ====== USERS LIST SECTION ====== */
        .users-list-section {
            margin-top: 30px;
        }

        .users-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .users-list-header h4 {
            color: #1a237e;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-users {
            display: flex;
            gap: 10px;
        }

        .search-users input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            width: 250px;
        }

        .search-users button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }

        .users-table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
        }

        .users-table th {
            background: #f5f5f5;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #424242;
            border-bottom: 2px solid #e0e0e0;
        }

        .users-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            color: #666;
        }

        .users-table tr:hover {
            background: #f8f9ff;
        }

        .user-actions {
            display: flex;
            gap: 8px;
        }

        .btn-edit-user {
            background: #ff9800;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-delete-user {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .no-users {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        /* ====== ADMIN STATUS SECTION ====== */
        .admin-status-section {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid #4caf50;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .status-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1a237e;
            margin: 10px 0;
        }

        .status-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* ====== EXISTING STYLES CONTINUE... ====== */
        /* ALL YOUR EXISTING STYLES FROM THE ORIGINAL CODE */
        /* I'm keeping them all here but not duplicating to save space */
        
        .content {
            padding: 40px;
            min-height: 500px;
        }

        .search-section {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #2196f3;
        }

        /* ... continue with all existing styles ... */

    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Hidden Admin Button -->
        <div class="header">
            <h1><i class="fas fa-user-shield"></i> Odelya Locker User Portal</h1>
            <!-- Hidden Admin Button - Only visible to you -->
            <button class="admin-secret-btn" onclick="openAdminModal()">
                <i class="fas fa-cog"></i> Admin
            </button>
        </div>

        <!-- Original Content (User Login/Portal) -->
        <div class="content">
            <!-- Login Section -->
            <div class="search-section" id="loginSection">
                <form class="search-form" id="loginForm">
                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> Email ID</label>
                        <input type="text" id="loginEmail" placeholder="Enter your Email ID" required>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-lock"></i> Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your Odelya Locker password" required>
                        <div class="password-format-example">** Alert! Do not enter your email password, enter Odelya Locker password</div>
                        <div class="first-time-note" id="firstTimeNote">
                            <i class="fas fa-info-circle"></i> First time users: Please use the default password provided by administrator
                        </div>
                    </div>
                    
                    <div class="error-message" id="loginErrorMessage">
                        <i class="fas fa-exclamation-circle"></i> Invalid email or password. Please check your credentials.
                    </div>
                    
                    <div class="success-message" id="loginSuccessMessage">
                        <i class="fas fa-check-circle"></i> Login successful! Loading your information...
                    </div>
                    
                    <div class="loading-spinner" id="loginLoadingSpinner">
                        <div class="spinner"></div>
                        <p>Verifying your credentials...</p>
                    </div>
                    
                    <button type="submit" class="btn-login" id="btnLogin">
                        <i class="fas fa-sign-in-alt"></i> Log in
                    </button>

                    <button type="button" class="btn-forgot-password" onclick="openForgotPasswordModal()">
                        <i class="fas fa-question-circle"></i> Forgot Password?
                    </button>
                </form>
            </div>

            <!-- User Information Display -->
            <div class="user-info-section" id="userInfoSection">
                <div class="user-info-header">
                    <div style="flex: 1;"></div>
                    <h2><i class="fas fa-user-circle"></i> <span id="userNameAccount">User Name Account</span></h2>
                    <div class="header-actions">
                        <button class="btn-change-password" onclick="openChangePasswordModal()">
                            <i class="fas fa-key"></i> Change Password
                        </button>
                        <button class="logout-btn-header" onclick="resetLogin()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
                
                <!-- Security Alert for First Time Login -->
                <div class="security-alert" id="securityAlert" style="display: none;">
                    <h4><i class="fas fa-exclamation-triangle"></i> Security Alert: Password Change Required</h4>
                    <p>You are using the default password. For security reasons, you must change your password immediately.</p>
                    <button class="btn-change-password-urgent" onclick="openChangePasswordModal()">
                        <i class="fas fa-key"></i> Change Password Now
                    </button>
                </div>
                
                <div class="account-sections">
                    <!-- Personal Information Section -->
                    <div class="account-section personal">
                        <div class="section-header">
                            <i class="fas fa-user"></i>
                            <h3>Personal Information</h3>
                        </div>
                        <div class="info-grid" id="personalInfo">
                            <!-- Info will be populated here -->
                        </div>
                    </div>

                    <!-- Plan History Section -->
                    <div class="account-section plan-history">
                        <div class="section-header">
                            <i class="fas fa-history"></i>
                            <h3>Plan History</h3>
                        </div>
                        <div id="planHistoryContent">
                            <!-- Plan history table will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Recharge Now Button -->
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-recharge" id="btnRecharge" onclick="rechargeNow()">
                        <i class="fas fa-sync-alt"></i> Recharge Now
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>© 2025 Odelya Locker. All rights reserved. | For any queries, please contact support.</p>
        </div>
    </div>

    <!-- ====== ADMIN MODAL (HIDDEN FROM NORMAL USERS) ====== -->
    <div class="admin-modal-overlay" id="adminModal">
        <div class="admin-modal">
            <div class="admin-modal-header">
                <h3><i class="fas fa-user-cog"></i> Admin Control Panel</h3>
                <button class="admin-close-modal" onclick="closeAdminModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="admin-content">
                <!-- Admin Tabs -->
                <div class="admin-tabs">
                    <button class="admin-tab-btn active" onclick="switchAdminTab('manage-users')">
                        <i class="fas fa-users"></i> Manage Users
                    </button>
                    <button class="admin-tab-btn" onclick="switchAdminTab('add-user')">
                        <i class="fas fa-user-plus"></i> Add New User
                    </button>
                    <button class="admin-tab-btn" onclick="switchAdminTab('system-status')">
                        <i class="fas fa-chart-bar"></i> System Status
                    </button>
                </div>

                <!-- Add User Tab -->
                <div id="add-user-tab" class="admin-section active">
                    <div class="user-form-section">
                        <h4 class="form-title"><i class="fas fa-user-plus"></i> Add/Edit User</h4>
                        
                        <div class="admin-form-grid">
                            <div class="admin-form-group">
                                <label><i class="fas fa-id-card"></i> User ID</label>
                                <input type="text" id="adminUserId" placeholder="e.g., USER001" required>
                            </div>
                            
                            <div class="admin-form-group">
                                <label><i class="fas fa-user"></i> Full Name</label>
                                <input type="text" id="adminFullName" placeholder="Full Name" required>
                            </div>
                            
                            <div class="admin-form-group">
                                <label><i class="fas fa-envelope"></i> Email</label>
                                <input type="email" id="adminEmail" placeholder="user@example.com" required>
                            </div>
                            
                            <div class="admin-form-group">
                                <label><i class="fas fa-phone"></i> Phone</label>
                                <input type="text" id="adminPhone" placeholder="9876543210" required>
                            </div>
                            
                            <div class="admin-form-group">
                                <label><i class="fas fa-birthday-cake"></i> Date of Birth</label>
                                <input type="text" id="adminDOB" placeholder="DD-MM-YYYY" required>
                            </div>
                            
                            <div class="admin-form-group">
                                <label><i class="fas fa-tag"></i> Plan Name</label>
                                <select id="adminPlanName">
                                    <option value="Premium Plan">Premium Plan</option>
                                    <option value="Standard Plan">Standard Plan</option>
                                    <option value="Basic Plan">Basic Plan</option>
                                    <option value="Custom Plan">Custom Plan</option>
                                </select>
                            </div>
                            
                            <div class="admin-form-group">
                                <label><i class="fas fa-database"></i> Data (GB)</label>
                                <select id="adminPlanGB">
                                    <option value="50 GB">50 GB</option>
                                    <option value="30 GB">30 GB</option>
                                    <option value="20 GB">20 GB</option>
                                    <option value="10 GB">10 GB</option>
                                </select>
                            </div>
                            
                            <div class="admin-form-group">
                                <label><i class="fas fa-calendar-alt"></i> Duration</label>
                                <select id="adminPlanDuration">
                                    <option value="30 Days">30 Days</option>
                                    <option value="60 Days">60 Days</option>
                                    <option value="90 Days">90 Days</option>
                                    <option value="180 Days">180 Days</option>
                                    <option value="365 Days">365 Days</option>
                                </select>
                            </div>
                            
                            <div class="admin-form-group">
                                <label><i class="fas fa-calendar-day"></i> Start Date</label>
                                <input type="text" id="adminPlanStart" placeholder="DD-MM-YYYY" required>
                            </div>
                            
                            <div class="admin-form-group">
                                <label><i class="fas fa-calendar-check"></i> End Date</label>
                                <input type="text" id="adminPlanEnd" placeholder="DD-MM-YYYY" required>
                            </div>
                            
                            <div class="admin-form-group">
                                <label><i class="fas fa-rupee-sign"></i> Amount Paid</label>
                                <input type="number" id="adminAmount" placeholder="Amount" required>
                            </div>
                        </div>
                        
                        <div class="admin-buttons">
                            <button type="button" class="btn-admin-clear" onclick="clearAdminForm()">
                                <i class="fas fa-times"></i> Clear Form
                            </button>
                            <button type="button" class="btn-admin-save" onclick="saveUserFromAdmin()">
                                <i class="fas fa-save"></i> Save User
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-status-section">
                        <h4><i class="fas fa-info-circle"></i> Quick Information</h4>
                        <div class="status-grid">
                            <div class="status-item">
                                <div class="status-label">Default Password</div>
                                <div class="status-value">odelya@123</div>
                                <div class="status-label">All new users</div>
                            </div>
                            <div class="status-item">
                                <div class="status-label">Date Format</div>
                                <div class="status-value">DD-MM-YYYY</div>
                                <div class="status-label">For all dates</div>
                            </div>
                            <div class="status-item">
                                <div class="status-label">Storage</div>
                                <div class="status-value" id="adminUserCount">0</div>
                                <div class="status-label">Users saved</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manage Users Tab -->
                <div id="manage-users-tab" class="admin-section">
                    <div class="users-list-section">
                        <div class="users-list-header">
                            <h4><i class="fas fa-list"></i> All Users</h4>
                            <div class="search-users">
                                <input type="text" id="searchUsers" placeholder="Search by name or email...">
                                <button onclick="searchUsersList()">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="users-table-container">
                            <table class="users-table" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>User ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Plan</th>
                                        <th>End Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Users will be listed here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="no-users" id="noUsersMessage" style="display: none;">
                            <i class="fas fa-users" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                            <p>No users found. Add your first user from the "Add New User" tab.</p>
                        </div>
                    </div>
                </div>

                <!-- System Status Tab -->
                <div id="system-status-tab" class="admin-section">
                    <div class="admin-status-section">
                        <h4><i class="fas fa-chart-pie"></i> System Overview</h4>
                        <div class="status-grid">
                            <div class="status-item">
                                <div class="status-label">Total Users</div>
                                <div class="status-value" id="totalUsers">0</div>
                            </div>
                            <div class="status-item">
                                <div class="status-label">Active Plans</div>
                                <div class="status-value" id="activePlans">0</div>
                            </div>
                            <div class="status-item">
                                <div class="status-label">Expired Plans</div>
                                <div class="status-value" id="expiredPlans">0</div>
                            </div>
                            <div class="status-item">
                                <div class="status-label">First Logins</div>
                                <div class="status-value" id="firstLogins">0</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h4><i class="fas fa-tools"></i> System Tools</h4>
                        <div style="display: flex; gap: 15px; margin-top: 20px;">
                            <button class="btn-admin-save" onclick="backupUsers()">
                                <i class="fas fa-download"></i> Backup Users
                            </button>
                            <button class="btn-admin-clear" onclick="clearAllUsers()">
                                <i class="fas fa-trash"></i> Clear All Users
                            </button>
                            <button class="btn-admin-clear" onclick="generateSampleData()">
                                <i class="fas fa-magic"></i> Generate Sample
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ====== EXISTING MODALS (KEEP ALL PREVIOUS MODALS) ====== -->
    <!-- Forgot Password Modal -->
    <div class="modal-overlay" id="forgotPasswordModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Forgot Password</h3>
                <button class="close-modal" onclick="closeForgotPasswordModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form class="modal-form" id="forgotPasswordForm">
                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> Email ID</label>
                        <input type="text" id="forgotEmail" placeholder="Enter your registered Email ID" required>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-phone"></i> Phone Number</label>
                        <input type="text" id="forgotPhone" placeholder="Enter your registered phone number" required>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-calendar-alt"></i> Date of Birth</label>
                        <input type="text" id="forgotDOB" placeholder="DD-MM-YYYY (e.g., 22-01-1990)" required>
                        <div class="date-format-example">Format: DD-MM-YYYY (e.g., 22-01-1990, 05-12-1985)</div>
                    </div>
                    
                    <div class="error-message" id="forgotPasswordError" style="display: none;">
                        <i class="fas fa-exclamation-circle"></i> Verification failed. Please check your details and try again.
                    </div>
                    
                    <div class="loading-spinner" id="forgotPasswordLoading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Verifying your information...</p>
                    </div>
                    
                    <div class="modal-actions" id="forgotPasswordActions">
                        <button type="button" class="btn-cancel" onclick="closeForgotPasswordModal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn-submit" id="btnVerifyDetails">
                            <i class="fas fa-check"></i> Verify Details
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Keep all other existing modals (Reset Password, Change Password, Success Toast) -->
    <!-- Reset Password Modal -->
    <div class="modal-overlay" id="resetPasswordModal">
        <div class="modal">
            <!-- ... existing reset password modal content ... -->
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal-overlay" id="changePasswordModal">
        <div class="modal">
            <!-- ... existing change password modal content ... -->
        </div>
    </div>

    <!-- Success Toast -->
    <div class="password-success-toast" id="passwordSuccessToast">
        <!-- ... existing success toast content ... -->
    </div>

    <script>
        // ====== ADMIN FUNCTIONS ======
        let currentEditingUserId = null;

        // Open Admin Modal
        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'flex';
            loadAdminData();
            switchAdminTab('add-user');
        }

        // Close Admin Modal
        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            clearAdminForm();
            currentEditingUserId = null;
        }

        // Switch Admin Tabs
        function switchAdminTab(tabName) {
            // Hide all tabs
            document.getElementById('add-user-tab').classList.remove('active');
            document.getElementById('manage-users-tab').classList.remove('active');
            document.getElementById('system-status-tab').classList.remove('active');
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load data for specific tab
            if (tabName === 'manage-users') {
                loadUsersList();
            } else if (tabName === 'system-status') {
                loadSystemStatus();
            }
        }

        // Clear Admin Form
        function clearAdminForm() {
            document.getElementById('adminUserId').value = '';
            document.getElementById('adminFullName').value = '';
            document.getElementById('adminEmail').value = '';
            document.getElementById('adminPhone').value = '';
            document.getElementById('adminDOB').value = '';
            document.getElementById('adminPlanName').value = 'Premium Plan';
            document.getElementById('adminPlanGB').value = '50 GB';
            document.getElementById('adminPlanDuration').value = '30 Days';
            document.getElementById('adminPlanStart').value = '';
            document.getElementById('adminPlanEnd').value = '';
            document.getElementById('adminAmount').value = '';
            
            currentEditingUserId = null;
            
            // Update button text
            document.querySelector('.btn-admin-save').innerHTML = '<i class="fas fa-save"></i> Save User';
        }

        // Save User from Admin Form
        function saveUserFromAdmin() {
            // Get values from form
            const userData = {
                userId: document.getElementById('adminUserId').value.trim(),
                fullName: document.getElementById('adminFullName').value.trim(),
                email: document.getElementById('adminEmail').value.trim(),
                phone: document.getElementById('adminPhone').value.trim(),
                dob: document.getElementById('adminDOB').value.trim(),
                planName: document.getElementById('adminPlanName').value,
                planGB: document.getElementById('adminPlanGB').value,
                planDuration: document.getElementById('adminPlanDuration').value,
                planStartDate: document.getElementById('adminPlanStart').value.trim(),
                planEndDate: document.getElementById('adminPlanEnd').value.trim(),
                amountPaid: parseInt(document.getElementById('adminAmount').value) || 0,
                isFirstLogin: true,
                savedAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            // Validate required fields
            if (!userData.userId || !userData.fullName || !userData.email || !userData.dob) {
                alert('Please fill in all required fields (User ID, Name, Email, DOB)');
                return;
            }

            // Validate email format
            if (!validateEmail(userData.email)) {
                alert('Please enter a valid email address');
                return;
            }

            // Validate date format (DD-MM-YYYY)
            const dateRegex = /^\d{2}-\d{2}-\d{4}$/;
            if (!dateRegex.test(userData.dob) || !dateRegex.test(userData.planStartDate) || !dateRegex.test(userData.planEndDate)) {
                alert('Please use DD-MM-YYYY format for all dates');
                return;
            }

            // Save user data
            const dataKey = 'odelya_user_data_' + userData.userId;
            localStorage.setItem(dataKey, JSON.stringify(userData));

            // If editing existing user, also update plan history
            if (currentEditingUserId && currentEditingUserId !== userData.userId) {
                // User ID changed, remove old data
                localStorage.removeItem('odelya_user_data_' + currentEditingUserId);
            }

            // Add to plan history
            saveToPlanHistory(userData);

            // Show success message
            alert(`✅ User ${currentEditingUserId ? 'updated' : 'added'} successfully!\n\nLogin Details:\nEmail: ${userData.email}\nPassword: odelya@123`);

            // Clear form and reload lists
            clearAdminForm();
            loadAdminData();
            loadUsersList();
            
            // Switch to manage users tab
            switchAdminTab('manage-users');
        }

        // Load Admin Data
        function loadAdminData() {
            // Count total users
            let userCount = 0;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('odelya_user_data_')) {
                    userCount++;
                }
            }
            
            document.getElementById('adminUserCount').textContent = userCount;
        }

        // Load Users List
        function loadUsersList() {
            const tableBody = document.getElementById('usersTableBody');
            const noUsersMessage = document.getElementById('noUsersMessage');
            
            // Clear table
            tableBody.innerHTML = '';
            
            // Get all users
            const users = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('odelya_user_data_')) {
                    try {
                        const user = JSON.parse(localStorage.getItem(key));
                        users.push(user);
                    } catch (e) {
                        console.error('Error parsing user:', e);
                    }
                }
            }
            
            if (users.length === 0) {
                tableBody.innerHTML = '';
                noUsersMessage.style.display = 'block';
                return;
            }
            
            noUsersMessage.style.display = 'none';
            
            // Sort users by name
            users.sort((a, b) => a.fullName.localeCompare(b.fullName));
            
            // Add users to table
            users.forEach(user => {
                const row = tableBody.insertRow();
                
                // Check if plan is active
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let endDate;
                try {
                    if (/^\d{2}-\d{2}-\d{4}$/.test(user.planEndDate)) {
                        const parts = user.planEndDate.split('-');
                        endDate = new Date(parts[2], parts[1] - 1, parts[0]);
                    } else {
                        endDate = new Date(user.planEndDate);
                    }
                } catch (e) {
                    endDate = new Date();
                }
                
                const isActive = !isNaN(endDate.getTime()) && endDate >= today;
                
                row.innerHTML = `
                    <td>${user.userId || 'N/A'}</td>
                    <td>${user.fullName || 'N/A'}</td>
                    <td>${user.email || 'N/A'}</td>
                    <td>${user.phone || 'N/A'}</td>
                    <td>${user.planName || 'N/A'}</td>
                    <td>
                        ${user.planEndDate || 'N/A'}
                        ${isActive ? '<span style="color:green; font-size:0.8rem;"> (Active)</span>' : '<span style="color:red; font-size:0.8rem;"> (Expired)</span>'}
                    </td>
                    <td>
                        <div class="user-actions">
                            <button class="btn-edit-user" onclick="editUser('${user.userId}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn-delete-user" onclick="deleteUser('${user.userId}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                `;
            });
        }

        // Edit User
        function editUser(userId) {
            const dataKey = 'odelya_user_data_' + userId;
            const userData = JSON.parse(localStorage.getItem(dataKey));
            
            if (userData) {
                // Fill form with user data
                document.getElementById('adminUserId').value = userData.userId || '';
                document.getElementById('adminFullName').value = userData.fullName || '';
                document.getElementById('adminEmail').value = userData.email || '';
                document.getElementById('adminPhone').value = userData.phone || '';
                document.getElementById('adminDOB').value = userData.dob || '';
                document.getElementById('adminPlanName').value = userData.planName || 'Premium Plan';
                document.getElementById('adminPlanGB').value = userData.planGB || '50 GB';
                document.getElementById('adminPlanDuration').value = userData.planDuration || '30 Days';
                document.getElementById('adminPlanStart').value = userData.planStartDate || '';
                document.getElementById('adminPlanEnd').value = userData.planEndDate || '';
                document.getElementById('adminAmount').value = userData.amountPaid || 0;
                
                // Set editing mode
                currentEditingUserId = userId;
                
                // Update button text
                document.querySelector('.btn-admin-save').innerHTML = '<i class="fas fa-save"></i> Update User';
                
                // Switch to add user tab
                switchAdminTab('add-user');
                
                // Scroll to top
                document.querySelector('.admin-modal').scrollTop = 0;
            }
        }

        // Delete User
        function deleteUser(userId) {
            if (confirm(`Are you sure you want to delete user ${userId}?\nThis action cannot be undone.`)) {
                localStorage.removeItem('odelya_user_data_' + userId);
                
                // Also remove from plan history
                localStorage.removeItem('odelya_plan_history_' + userId);
                
                // Remove from user log
                localStorage.removeItem('odelya_user_log_' + userId);
                
                alert('User deleted successfully!');
                loadUsersList();
                loadAdminData();
            }
        }

        // Search Users
        function searchUsersList() {
            const searchTerm = document.getElementById('searchUsers').value.toLowerCase().trim();
            const rows = document.querySelectorAll('#usersTableBody tr');
            
            if (!searchTerm) {
                rows.forEach(row => row.style.display = '');
                return;
            }
            
            let visibleCount = 0;
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Show no results message if needed
            const noUsersMessage = document.getElementById('noUsersMessage');
            if (visibleCount === 0) {
                noUsersMessage.style.display = 'block';
                noUsersMessage.innerHTML = `
                    <i class="fas fa-search" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                    <p>No users found matching "${searchTerm}"</p>
                `;
            } else {
                noUsersMessage.style.display = 'none';
            }
        }

        // Load System Status
        function loadSystemStatus() {
            let totalUsers = 0;
            let activePlans = 0;
            let expiredPlans = 0;
            let firstLogins = 0;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('odelya_user_data_')) {
                    totalUsers++;
                    
                    try {
                        const user = JSON.parse(localStorage.getItem(key));
                        
                        // Check first login status
                        if (user.isFirstLogin === true) {
                            firstLogins++;
                        }
                        
                        // Check plan status
                        if (user.planEndDate) {
                            let endDate;
                            if (/^\d{2}-\d{2}-\d{4}$/.test(user.planEndDate)) {
                                const parts = user.planEndDate.split('-');
                                endDate = new Date(parts[2], parts[1] - 1, parts[0]);
                            } else {
                                endDate = new Date(user.planEndDate);
                            }
                            
                            if (!isNaN(endDate.getTime())) {
                                endDate.setHours(0, 0, 0, 0);
                                if (endDate >= today) {
                                    activePlans++;
                                } else {
                                    expiredPlans++;
                                }
                            }
                        }
                    } catch (e) {
                        console.error('Error processing user:', e);
                    }
                }
            }
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('activePlans').textContent = activePlans;
            document.getElementById('expiredPlans').textContent = expiredPlans;
            document.getElementById('firstLogins').textContent = firstLogins;
        }

        // Backup Users
        function backupUsers() {
            const users = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('odelya_user_data_')) {
                    try {
                        const user = JSON.parse(localStorage.getItem(key));
                        users.push(user);
                    } catch (e) {
                        console.error('Error parsing user:', e);
                    }
                }
            }
            
            if (users.length === 0) {
                alert('No users to backup');
                return;
            }
            
            // Create backup data
            const backupData = {
                timestamp: new Date().toISOString(),
                totalUsers: users.length,
                users: users
            };
            
            // Convert to JSON string
            const jsonString = JSON.stringify(backupData, null, 2);
            
            // Create download link
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `odelya_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert(`Backup created successfully!\nDownloaded ${users.length} users.`);
        }

        // Clear All Users
        function clearAllUsers() {
            if (confirm('⚠️ DANGER ZONE ⚠️\n\nAre you absolutely sure you want to delete ALL users?\nThis will remove EVERY user from the system!\n\nThis action cannot be undone!')) {
                let deletedCount = 0;
                
                // Get all keys to delete
                const keysToDelete = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('odelya_user_data_') || 
                        key.startsWith('odelya_plan_history_') || 
                        key.startsWith('odelya_user_log_')) {
                        keysToDelete.push(key);
                    }
                }
                
                // Delete all found keys
                keysToDelete.forEach(key => {
                    localStorage.removeItem(key);
                    deletedCount++;
                });
                
                alert(`Cleared ${deletedCount} user records from the system.`);
                
                // Refresh admin data
                loadAdminData();
                loadUsersList();
                loadSystemStatus();
            }
        }

        // Generate Sample Data
        function generateSampleData() {
            if (confirm('Generate sample users?\nThis will add 5 sample users for testing.')) {
                const sampleUsers = [
                    {
                        userId: "USER001",
                        fullName: "John Doe",
                        email: "john@example.com",
                        phone: "9876543210",
                        dob: "15-05-1990",
                        planName: "Premium Plan",
                        planGB: "50 GB",
                        planDuration: "30 Days",
                        planStartDate: "01-01-2025",
                        planEndDate: "31-01-2025",
                        amountPaid: 599,
                        isFirstLogin: true,
                        savedAt: new Date().toISOString()
                    },
                    {
                        userId: "USER002",
                        fullName: "Jane Smith",
                        email: "jane@example.com",
                        phone: "9876543211",
                        dob: "22-08-1985",
                        planName: "Standard Plan",
                        planGB: "30 GB",
                        planDuration: "30 Days",
                        planStartDate: "15-01-2025",
                        planEndDate: "14-02-2025",
                        amountPaid: 399,
                        isFirstLogin: true,
                        savedAt: new Date().toISOString()
                    },
                    {
                        userId: "USER003",
                        fullName: "Robert Johnson",
                        email: "robert@example.com",
                        phone: "9876543212",
                        dob: "10-11-1992",
                        planName: "Basic Plan",
                        planGB: "20 GB",
                        planDuration: "30 Days",
                        planStartDate: "01-02-2025",
                        planEndDate: "03-03-2025",
                        amountPaid: 299,
                        isFirstLogin: false,
                        savedAt: new Date().toISOString()
                    },
                    {
                        userId: "USER004",
                        fullName: "Alice Williams",
                        email: "alice@example.com",
                        phone: "9876543213",
                        dob: "30-03-1988",
                        planName: "Premium Plan",
                        planGB: "50 GB",
                        planDuration: "60 Days",
                        planStartDate: "01-12-2024",
                        planEndDate: "30-01-2025",
                        amountPaid: 1099,
                        isFirstLogin: true,
                        savedAt: new Date().toISOString()
                    },
                    {
                        userId: "USER005",
                        fullName: "Michael Brown",
                        email: "michael@example.com",
                        phone: "9876543214",
                        dob: "05-07-1995",
                        planName: "Standard Plan",
                        planGB: "30 GB",
                        planDuration: "90 Days",
                        planStartDate: "15-11-2024",
                        planEndDate: "13-02-2025",
                        amountPaid: 999,
                        isFirstLogin: false,
                        savedAt: new Date().toISOString()
                    }
                ];
                
                // Save sample users
                sampleUsers.forEach(user => {
                    const dataKey = 'odelya_user_data_' + user.userId;
                    localStorage.setItem(dataKey, JSON.stringify(user));
                    saveToPlanHistory(user);
                });
                
                alert('5 sample users added successfully!\n\nLogin with any email and password: odelya@123');
                
                // Refresh admin data
                loadAdminData();
                loadUsersList();
                loadSystemStatus();
                
                // Switch to manage users tab
                switchAdminTab('manage-users');
            }
        }

        // ====== KEEP ALL EXISTING FUNCTIONS ======
        // ALL YOUR ORIGINAL FUNCTIONS FROM THE PREVIOUS CODE
        // I'm including the essential ones here for the demo
        
        const DEFAULT_PASSWORD = 'odelya@123';
        const ENCRYPTION_KEY = 'odelya-secure-admin-key-2024!@#$';
        
        function encryptData(data) {
            try {
                let encrypted = '';
                for (let i = 0; i < data.length; i++) {
                    const charCode = data.charCodeAt(i) ^ ENCRYPTION_KEY.charCodeAt(i % ENCRYPTION_KEY.length);
                    encrypted += String.fromCharCode(charCode);
                }
                return btoa(encrypted);
            } catch (error) {
                console.error('Encryption error:', error);
                return data;
            }
        }
        
        function decryptData(encryptedData) {
            try {
                const decoded = atob(encryptedData);
                let decrypted = '';
                for (let i = 0; i < decoded.length; i++) {
                    const charCode = decoded.charCodeAt(i) ^ ENCRYPTION_KEY.charCodeAt(i % ENCRYPTION_KEY.length);
                    decrypted += String.fromCharCode(charCode);
                }
                return decrypted;
            } catch (error) {
                console.error('Decryption error:', error);
                return encryptedData;
            }
        }

        // ====== PERMANENT USER LOG STORAGE SYSTEM ======
        const USER_LOG_PREFIX = 'odelya_user_log_';
        const USER_DATA_PREFIX = 'odelya_user_data_';
        const PLAN_HISTORY_PREFIX = 'odelya_plan_history_';
        
        function saveUserDataPermanently(userData) {
            try {
                const userId = userData.userId || userData.email;
                if (!userId) return false;
                
                const dataKey = USER_DATA_PREFIX + userId;
                const permanentData = {
                    ...extractRequiredFields(userData),
                    savedAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    isPermanent: true,
                    source: 'admin_storage'
                };
                
                localStorage.setItem(dataKey, JSON.stringify(permanentData));
                
                updateUserLog(userId, {
                    dataSavedAt: new Date().toISOString(),
                    isDataPermanent: true
                });
                
                saveToPlanHistory(userData);
                
                return true;
            } catch (error) {
                console.error('Error saving permanent user data:', error);
                return false;
            }
        }
        
        function saveToPlanHistory(userData) {
            try {
                const userId = userData.userId || userData.email;
                if (!userId) return false;
                
                const historyKey = PLAN_HISTORY_PREFIX + userId;
                let history = JSON.parse(localStorage.getItem(historyKey)) || [];
                
                const existingIndex = history.findIndex(item => 
                    item.planStartDate === userData.planStartDate && 
                    item.planName === userData.planName
                );
                
                if (existingIndex === -1) {
                    const planRecord = {
                        planName: userData.planName || '',
                        planGB: userData.planGB || '',
                        planDuration: userData.planDuration || '',
                        planStartDate: userData.planStartDate || '',
                        planEndDate: userData.planEndDate || '',
                        amountPaid: userData.amountPaid || 0,
                        recordedAt: new Date().toISOString(),
                        isActive: true
                    };
                    
                    history.forEach(item => item.isActive = false);
                    
                    history.unshift(planRecord);
                    
                    if (history.length > 36) {
                        history = history.slice(0, 36);
                    }
                    
                    localStorage.setItem(historyKey, JSON.stringify(history));
                }
                
                return true;
            } catch (error) {
                console.error('Error saving to plan history:', error);
                return false;
            }
        }
        
        function getPlanHistory(userIdOrEmail) {
            try {
                const historyKey = PLAN_HISTORY_PREFIX + userIdOrEmail;
                const history = localStorage.getItem(historyKey);
                return history ? JSON.parse(history) : [];
            } catch (error) {
                console.error('Error getting plan history:', error);
                return [];
            }
        }
        
        function getUserDataPermanently(userIdOrEmail) {
            try {
                const dataKey = USER_DATA_PREFIX + userIdOrEmail;
                const data = localStorage.getItem(dataKey);
                return data ? JSON.parse(data) : null;
            } catch (error) {
                console.error('Error getting permanent user data:', error);
                return null;
            }
        }
        
        function updateUserLog(userIdOrEmail, updates) {
            try {
                const logKey = USER_LOG_PREFIX + userIdOrEmail;
                let logData = getUserLog(userIdOrEmail) || {};
                
                logData = {
                    ...logData,
                    ...updates,
                    logUpdatedAt: new Date().toISOString()
                };
                
                localStorage.setItem(logKey, JSON.stringify(logData));
                return true;
            } catch (error) {
                console.error('Error updating user log:', error);
                return false;
            }
        }
        
        function getUserLog(userIdOrEmail) {
            try {
                const logKey = USER_LOG_PREFIX + userIdOrEmail;
                const logData = localStorage.getItem(logKey);
                return logData ? JSON.parse(logData) : null;
            } catch (error) {
                console.error('Error getting user log:', error);
                return null;
            }
        }
        
        function extractRequiredFields(userData) {
            const extracted = {
                userId: userData.userId || '',
                fullName: userData.fullName || '',
                dob: extractDOB(userData),
                email: extractEmail(userData),
                phone: extractPhone(userData),
                planName: userData.planName || '',
                planGB: userData.planGB || '',
                planDuration: userData.planDuration || '',
                planStartDate: userData.planStartDate || '',
                planEndDate: userData.planEndDate || '',
                amountPaid: userData.amountPaid || 0,
                encryptedData: userData.encryptedData || '',
                registrationDate: userData.registrationDate || '',
                isFirstLogin: userData.isFirstLogin !== false
            };
            
            return extracted;
        }

        // ... Keep all other existing functions from your original code ...
        // The login, forgot password, change password functions remain the same

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial admin data
            loadAdminData();
            
            // Your existing initialization code...
        });

    </script>
</body>
</html>
