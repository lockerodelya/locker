<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Odelya</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .dashboard-container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            background: linear-gradient(to right, #2c3e50, #4a6491);
            color: white;
            padding: 30px;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-controls {
            display: flex;
            gap: 15px;
        }
        
        .btn-admin {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .btn-admin:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .content-area {
            padding: 30px;
        }
        
        /* Login Section */
        .login-section {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }
        
        .login-section h2 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .input-group {
            margin-bottom: 25px;
            text-align: left;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .input-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .input-group input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(to right, #2980b9, #2c3e50);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            background: linear-gradient(to right, #3498db, #34495e);
            transform: translateY(-2px);
        }
        
        /* Dashboard Stats */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 5px solid #3498db;
            text-align: center;
        }
        
        .stat-card h3 {
            color: #2c3e50;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-card .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #1a2980;
        }
        
        /* Users Table */
        .users-section {
            margin-top: 40px;
        }
        
        .section-title {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .users-table-container {
            overflow-x: auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 20px;
            margin-top: 20px;
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .users-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            color: #2c3e50;
            font-weight: 600;
            border-bottom: 2px solid #e9ecef;
        }
        
        .users-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            color: #495057;
        }
        
        .users-table tr:hover {
            background: #f8f9fa;
        }
        
        .user-id {
            font-family: monospace;
            font-weight: 700;
            color: #1a2980;
            background: #e3f2fd;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-view {
            background: #3498db;
            color: white;
        }
        
        .btn-view:hover {
            background: #2980b9;
        }
        
        .btn-email {
            background: #27ae60;
            color: white;
            margin-left: 10px;
        }
        
        .btn-email:hover {
            background: #219653;
        }
        
        /* Password Change Modal */
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .password-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .password-content h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .message {
            padding: 12px 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
            font-size: 14px;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #ef5350;
        }
        
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }
        
        /* User Details Modal */
        .user-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }
        
        .user-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .user-header h3 {
            color: #2c3e50;
            font-size: 24px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #7f8c8d;
            cursor: pointer;
        }
        
        .user-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .detail-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }
        
        .detail-label {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .detail-value {
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
        }
        
        /* Search Bar */
        .search-container {
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 14px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .search-input:focus {
            border-color: #3498db;
            outline: none;
        }
        
        /* No Data Message */
        .no-data {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 18px;
        }
        
        .no-data i {
            font-size: 48px;
            margin-bottom: 20px;
            color: #bdc3c7;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
            }
            
            .admin-controls {
                width: 100%;
                justify-content: center;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .users-table {
                font-size: 14px;
            }
            
            .users-table th, 
            .users-table td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-cogs"></i> Admin Dashboard</h1>
            <div class="admin-controls">
                <button class="btn-admin" onclick="exportData()">
                    <i class="fas fa-download"></i> Export
                </button>
                <button class="btn-admin" onclick="changePassword()">
                    <i class="fas fa-key"></i> Change Password
                </button>
                <button class="btn-admin" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="content-area">
            <!-- Login Section -->
            <div id="loginSection" class="login-section">
                <h2>Admin Login</h2>
                <div class="input-group">
                    <label>Admin Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                </div>
                <div id="loginMessage" class="message"></div>
                <button class="login-btn" onclick="adminLogin()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <p style="margin-top: 20px; color: #666; font-size: 14px;">
                    Default password: <strong>admin123</strong> (Change after first login)
                </p>
            </div>
            
            <!-- Dashboard Content -->
            <div id="dashboardContent" style="display: none;">
                <!-- Stats -->
                <div class="stats-container">
                    <div class="stat-card">
                        <h3>Total Users</h3>
                        <div class="stat-value" id="totalUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>This Month</h3>
                        <div class="stat-value" id="monthUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Revenue</h3>
                        <div class="stat-value" id="totalRevenue">₹ 0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Active Plans</h3>
                        <div class="stat-value" id="activePlans">0</div>
                    </div>
                </div>
                
                <!-- Users Table -->
                <div class="users-section">
                    <h3 class="section-title"><i class="fas fa-users"></i> Registered Users</h3>
                    
                    <div class="search-container">
                        <input type="text" class="search-input" id="searchInput" 
                               placeholder="Search by User ID, Name, Email, or Phone..." 
                               onkeyup="filterUsers()">
                    </div>
                    
                    <div class="users-table-container">
                        <table class="users-table" id="usersTable">
                            <thead>
                                <tr>
                                    <th>User ID</th>
                                    <th>Full Name</th>
                                    <th>Phone</th>
                                    <th>Email</th>
                                    <th>Plan</th>
                                    <th>Amount</th>
                                    <th>Start Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                        
                        <div id="noDataMessage" class="no-data" style="display: none;">
                            <i class="fas fa-database"></i>
                            <p>No users found. Users will appear here automatically when they complete payment.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Password Change Modal -->
    <div class="password-modal" id="passwordModal">
        <div class="password-content">
            <h3><i class="fas fa-key"></i> Change Admin Password</h3>
            <div class="input-group">
                <label>New Password</label>
                <input type="password" id="newPassword" placeholder="Enter new password">
            </div>
            <div class="input-group">
                <label>Confirm Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm new password">
            </div>
            <div id="passwordMessage" class="message"></div>
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="login-btn" onclick="saveNewPassword()" style="flex: 1;">
                    Save
                </button>
                <button class="login-btn" onclick="closePasswordModal()" 
                        style="flex: 1; background: #95a5a6;">
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- User Details Modal -->
    <div class="user-modal" id="userModal">
        <div class="user-content">
            <div class="user-header">
                <h3><i class="fas fa-user"></i> User Details</h3>
                <button class="close-btn" onclick="closeUserModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="userDetailsContent">
                <!-- User details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // ====== ENCRYPTION CONFIGURATION ======
        const ENCRYPTION_CONFIG = {
            STORAGE_KEY: 'odelya_encrypted_users_v2',
            ADMIN_KEY: 'odelya_admin_pass_v2',
            MASTER_KEY: 'odelya_secure_master_key_2024_!@#$%',
            SALT: 'odelya_salt_secure'
        };

        // ====== ADVANCED ENCRYPTION FUNCTIONS ======
        async function deriveKey(password, salt) {
            const encoder = new TextEncoder();
            const keyMaterial = await window.crypto.subtle.importKey(
                "raw",
                encoder.encode(password),
                {name: "PBKDF2"},
                false,
                ["deriveKey"]
            );
            
            return await window.crypto.subtle.deriveKey(
                {
                    name: "PBKDF2",
                    salt: encoder.encode(salt),
                    iterations: 100000,
                    hash: "SHA-256"
                },
                keyMaterial,
                {name: "AES-GCM", length: 256},
                false,
                ["encrypt", "decrypt"]
            );
        }

        async function encryptDataAdvanced(data) {
            try {
                const key = await deriveKey(ENCRYPTION_CONFIG.MASTER_KEY, ENCRYPTION_CONFIG.SALT);
                const iv = window.crypto.getRandomValues(new Uint8Array(12));
                const encoder = new TextEncoder();
                const encrypted = await window.crypto.subtle.encrypt(
                    {name: "AES-GCM", iv: iv},
                    key,
                    encoder.encode(JSON.stringify(data))
                );
                
                const combined = new Uint8Array(iv.length + encrypted.byteLength);
                combined.set(iv);
                combined.set(new Uint8Array(encrypted), iv.length);
                
                return btoa(String.fromCharCode(...combined));
            } catch (error) {
                console.error('Encryption error:', error);
                return null;
            }
        }

        async function decryptDataAdvanced(encryptedBase64) {
            try {
                const encryptedData = Uint8Array.from(atob(encryptedBase64), c => c.charCodeAt(0));
                const iv = encryptedData.slice(0, 12);
                const ciphertext = encryptedData.slice(12);
                
                const key = await deriveKey(ENCRYPTION_CONFIG.MASTER_KEY, ENCRYPTION_CONFIG.SALT);
                const decrypted = await window.crypto.subtle.decrypt(
                    {name: "AES-GCM", iv: iv},
                    key,
                    ciphertext
                );
                
                const decryptedText = new TextDecoder().decode(decrypted);
                return JSON.parse(decryptedText);
            } catch (error) {
                console.error('Decryption error:', error);
                return [];
            }
        }

        // ====== STATE MANAGEMENT ======
        let isLoggedIn = false;
        let allUsers = [];

        // ====== USER DATA MANAGEMENT ======
        async function loadUsers() {
            const encryptedData = localStorage.getItem(ENCRYPTION_CONFIG.STORAGE_KEY);
            if (encryptedData) {
                allUsers = await decryptDataAdvanced(encryptedData);
            } else {
                allUsers = [];
            }
            updateDashboard();
        }

        async function saveUsers() {
            const encryptedData = await encryptDataAdvanced(allUsers);
            if (encryptedData) {
                localStorage.setItem(ENCRYPTION_CONFIG.STORAGE_KEY, encryptedData);
                updateDashboard();
            }
        }

        // ====== CAPTURE DATA FROM PAYMENT PAGE ======
        function capturePaymentData(formData) {
            // Generate User ID (6 digits, 2-9, no zeros)
            function generateUserId() {
                let userId = '';
                const digits = '23456789';
                for (let i = 0; i < 6; i++) {
                    userId += digits.charAt(Math.floor(Math.random() * digits.length));
                }
                return userId;
            }

            const userId = generateUserId();
            
            // Create user object with all required fields
            const user = {
                userId: userId,
                timestamp: new Date().toISOString(),
                personalInfo: {
                    fullName: `${formData.personalInfo.fullName}`,
                    dob: formData.personalInfo.dob,
                    phone: formData.personalInfo.phone,
                    email: formData.personalInfo.email,
                    gender: formData.personalInfo.gender,
                    pan: formData.personalInfo.pan,
                    aadhaar: formData.personalInfo.aadhaar
                },
                serviceInfo: {
                    planGB: formData.serviceInfo.planGB,
                    duration: formData.serviceInfo.duration,
                    amountPaid: formData.serviceInfo.amountPaid,
                    serviceType: formData.serviceInfo.serviceType,
                    startDate: formData.serviceInfo.startDate,
                    endDate: formData.serviceInfo.endDate
                },
                paymentInfo: {
                    mode: formData.paymentInfo.mode,
                    status: 'Payment Processing'
                }
            };
            
            // Add to users array
            allUsers.push(user);
            
            // Save to encrypted storage
            saveUsers();
            
            // Log for debugging
            console.log(`New user captured: ${userId} - ${user.personalInfo.fullName}`);
            
            return userId;
        }

        // ====== ADMIN AUTHENTICATION ======
        function getAdminPassword() {
            const savedHash = localStorage.getItem(ENCRYPTION_CONFIG.ADMIN_KEY);
            return savedHash || 'admin123'; // Default password
        }

        function setAdminPassword(password) {
            localStorage.setItem(ENCRYPTION_CONFIG.ADMIN_KEY, password);
        }

        function adminLogin() {
            const passwordInput = document.getElementById('adminPassword');
            const password = passwordInput.value.trim();
            const messageDiv = document.getElementById('loginMessage');
            
            if (!password) {
                showMessage('Please enter password', 'error', 'loginMessage');
                return;
            }
            
            const savedPassword = getAdminPassword();
            
            if (password === savedPassword) {
                isLoggedIn = true;
                passwordInput.value = '';
                hideMessage('loginMessage');
                
                // Show dashboard
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
                
                // Load users
                loadUsers();
                
                showMessage('Login successful!', 'success', 'loginMessage');
                setTimeout(() => hideMessage('loginMessage'), 2000);
                
                // Set session
                sessionStorage.setItem('odelya_admin_logged_in', 'true');
            } else {
                showMessage('Invalid password', 'error', 'loginMessage');
            }
        }

        function logout() {
            isLoggedIn = false;
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';
            sessionStorage.removeItem('odelya_admin_logged_in');
        }

        // ====== PASSWORD CHANGE ======
        function changePassword() {
            document.getElementById('passwordModal').style.display = 'flex';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            hideMessage('passwordMessage');
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').style.display = 'none';
        }

        function saveNewPassword() {
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            
            if (!newPassword || !confirmPassword) {
                showMessage('Please fill both fields', 'error', 'passwordMessage');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showMessage('Passwords do not match', 'error', 'passwordMessage');
                return;
            }
            
            // Save new password (no complexity required)
            setAdminPassword(newPassword);
            
            showMessage('Password changed successfully!', 'success', 'passwordMessage');
            
            setTimeout(() => {
                closePasswordModal();
                hideMessage('passwordMessage');
            }, 2000);
        }

        // ====== DASHBOARD FUNCTIONS ======
        function updateDashboard() {
            // Update stats
            document.getElementById('totalUsers').textContent = allUsers.length;
            
            // This month's users
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            const monthUsers = allUsers.filter(user => {
                const date = new Date(user.timestamp);
                return date.getMonth() === thisMonth && date.getFullYear() === thisYear;
            }).length;
            document.getElementById('monthUsers').textContent = monthUsers;
            
            // Total revenue
            const totalRevenue = allUsers.reduce((sum, user) => {
                return sum + (parseInt(user.serviceInfo.amountPaid) || 0);
            }, 0);
            document.getElementById('totalRevenue').textContent = `₹ ${totalRevenue.toLocaleString()}`;
            
            // Active plans
            const today = new Date().toISOString().split('T')[0];
            const activePlans = allUsers.filter(user => user.serviceInfo.endDate >= today).length;
            document.getElementById('activePlans').textContent = activePlans;
            
            // Update table
            updateUsersTable();
        }

        function updateUsersTable() {
            const tableBody = document.getElementById('usersTableBody');
            const noDataMessage = document.getElementById('noDataMessage');
            
            if (allUsers.length === 0) {
                tableBody.innerHTML = '';
                noDataMessage.style.display = 'block';
                return;
            }
            
            noDataMessage.style.display = 'none';
            
            // Sort by latest first
            const sortedUsers = [...allUsers].sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            let tableHTML = '';
            
            sortedUsers.forEach(user => {
                const name = user.personalInfo.fullName;
                const phone = user.personalInfo.phone;
                const email = user.personalInfo.email;
                const plan = user.serviceInfo.serviceType;
                const amount = user.serviceInfo.amountPaid;
                const startDate = user.serviceInfo.startDate;
                
                tableHTML += `
                    <tr>
                        <td><span class="user-id">${user.userId}</span></td>
                        <td>${name}</td>
                        <td>${phone}</td>
                        <td>${email}</td>
                        <td>${plan}</td>
                        <td>₹ ${parseInt(amount).toLocaleString()}</td>
                        <td>${startDate}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="viewUserDetails('${user.userId}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="action-btn btn-email" onclick="emailUserID('${user.userId}')">
                                <i class="fas fa-envelope"></i> Email ID
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }

        function filterUsers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#usersTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // ====== USER DETAILS ======
        function viewUserDetails(userId) {
            const user = allUsers.find(u => u.userId === userId);
            if (!user) return;
            
            const detailsHTML = `
                <div class="user-details-grid">
                    <div class="detail-card">
                        <div class="detail-label">User ID</div>
                        <div class="detail-value">${user.userId}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Registration Date</div>
                        <div class="detail-value">${new Date(user.timestamp).toLocaleDateString()}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Full Name</div>
                        <div class="detail-value">${user.personalInfo.fullName}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Date of Birth</div>
                        <div class="detail-value">${user.personalInfo.dob}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Phone Number</div>
                        <div class="detail-value">${user.personalInfo.phone}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Email ID</div>
                        <div class="detail-value">${user.personalInfo.email}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Gender</div>
                        <div class="detail-value">${user.personalInfo.gender}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">PAN Number</div>
                        <div class="detail-value">${user.personalInfo.pan}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Aadhaar Number</div>
                        <div class="detail-value">${user.personalInfo.aadhaar}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Service Type</div>
                        <div class="detail-value">${user.serviceInfo.serviceType}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Plan Details</div>
                        <div class="detail-value">${user.serviceInfo.planGB} ${user.serviceInfo.serviceType === 'Cloud Storage' ? 'GB' : ''}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Duration</div>
                        <div class="detail-value">${user.serviceInfo.duration}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Amount Paid</div>
                        <div class="detail-value">₹ ${parseInt(user.serviceInfo.amountPaid).toLocaleString()}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Plan Start Date</div>
                        <div class="detail-value">${user.serviceInfo.startDate}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Plan End Date</div>
                        <div class="detail-value">${user.serviceInfo.endDate}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Payment Mode</div>
                        <div class="detail-value">${user.paymentInfo.mode}</div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Payment Status</div>
                        <div class="detail-value">${user.paymentInfo.status}</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; text-align: center;">
                    <button class="login-btn" onclick="closeUserModal()" style="max-width: 200px;">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            `;
            
            document.getElementById('userDetailsContent').innerHTML = detailsHTML;
            document.getElementById('userModal').style.display = 'flex';
        }

        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        function emailUserID(userId) {
            const user = allUsers.find(u => u.userId === userId);
            if (!user) return;
            
            alert(`User ID ${userId} would be emailed to: ${user.personalInfo.email}\n\nNote: Email functionality requires backend integration.`);
        }

        // ====== EXPORT DATA ======
        function exportData() {
            const dataStr = JSON.stringify(allUsers, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `odelya_users_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage('Data exported successfully!', 'success');
            setTimeout(() => hideMessage(), 2000);
        }

        // ====== UTILITY FUNCTIONS ======
        function showMessage(text, type = 'info', elementId = 'message') {
            const messageDiv = document.getElementById(elementId);
            messageDiv.textContent = text;
            messageDiv.className = 'message ' + type;
            messageDiv.style.display = 'block';
        }

        function hideMessage(elementId = 'message') {
            document.getElementById(elementId).style.display = 'none';
        }

        // ====== INITIALIZATION ======
        document.addEventListener('DOMContentLoaded', function() {
            // Check session login
            const savedLogin = sessionStorage.getItem('odelya_admin_logged_in');
            if (savedLogin === 'true') {
                isLoggedIn = true;
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
                loadUsers();
            }
            
            // Make capture function globally available for payment.html
            window.odelyaDashboard = {
                capturePaymentData: capturePaymentData,
                loadUsers: loadUsers,
                saveUsers: saveUsers
            };
            
            console.log('Admin Dashboard Loaded - Secure Version');
            console.log('Default Admin Password: admin123');
        });
    </script>
</body>
</html>
