<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Cloud Storage Plans - Odelya Cloud Digital Locker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ====== BASE STYLES ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fdff;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ====== HEADER STYLES ====== */
        header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 20px; /* Reduced padding */
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }
        
        .logo-image {
            height: 35px; /* Even smaller logo */
            width: 35px; /* Even smaller to fit in circle */
            border-radius: 50%; /* Circular logo */
            object-fit: contain; /* Changed to contain for better fit */
            border: 2px solid white;
            background-color: white; /* White background for better visibility */
            padding: 2px; /* Small padding */
        }
        
        /* Navigation */
        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .home-nav {
            color: white;
            text-decoration: none;
            padding: 8px 20px; /* Slightly more padding */
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 1.05rem; /* Bigger font for Home */
        }
        
        .home-nav:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        /* Hamburger Menu */
        .hamburger {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .hamburger:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Dropdown Menu */
        .dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 20px;
            background: white;
            min-width: 220px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            z-index: 1000;
            padding: 10px 0;
            border: 1px solid #e0e7ff;
        }
        
        .dropdown.active {
            display: block !important;
            animation: fadeIn 0.3s ease;
        }
        
        .dropdown a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #37474f;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .dropdown a:hover {
            background: #f8f9ff;
            color: #4361ee;
            border-left: 3px solid #4361ee;
            padding-left: 25px;
        }
        
        .dropdown a i {
            width: 25px;
            margin-right: 10px;
            color: #4361ee;
            font-size: 1.1rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ====== MAIN CONTENT STYLES ====== */
        main {
            flex: 1;
        }
        
        /* Hero Section - REDUCED HEIGHT BY 30% */
        .storage-hero {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1565c0;
            padding: 15px 20px 10px; /* Reduced padding by 30% */
            text-align: center;
            min-height: 130px; /* Reduced by 30% (was 180px) */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .storage-hero .container {
            width: 100%;
        }
        
        .storage-hero h1 {
            font-size: 2.2rem; /* Slightly smaller to match reduced height */
            margin-bottom: 8px; /* Reduced */
            font-weight: 700;
            color: #0d47a1;
        }
        
        .storage-hero p {
            font-size: 1rem; /* Slightly smaller */
            max-width: 900px;
            margin: 0 auto;
            color: #1976d2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 0 20px;
        }
        
        /* Make hero text single line on desktop */
        @media (min-width: 768px) {
            .storage-hero p {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }
        
        /* Storage Content */
        .storage-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 20px;
        }
        
        /* Pricing Section */
        .pricing-section {
            background: white;
            border-radius: 15px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border: 2px solid #e3f2fd;
            min-height: auto;
        }
        
        .section-title {
            color: #0d47a1;
            margin-bottom: 15px;
            font-size: 2rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .section-title i {
            color: #2196f3;
        }
        
        /* GST Notice */
        .gst-notice {
            text-align: center;
            color: #f44336;
            font-weight: 600;
            margin-bottom: 20px;
            padding: 10px;
            background: #ffebee;
            border-radius: 10px;
            border-left: 4px solid #f44336;
            font-size: 1rem;
        }
        
        .gst-notice i {
            margin-right: 8px;
        }
        
        /* Pricing Table */
        .pricing-table-container {
            overflow-x: auto;
            margin: 0 auto;
            width: 95%;
        }
        
        .pricing-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0 auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .pricing-table th {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            padding: 18px 20px;
            text-align: center;
            font-weight: 600;
            font-size: 1.2rem;
            border: none;
        }
        
        .pricing-table th:first-child {
            border-radius: 10px 0 0 0;
        }
        
        .pricing-table th:last-child {
            border-radius: 0 10px 0 0;
        }
        
        .pricing-table td {
            padding: 20px 25px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .pricing-table tr:hover {
            background-color: #f8fdff;
        }
        
        .plan-cell {
            font-weight: 700;
            color: #0d47a1;
            font-size: 1.3rem;
        }
        
        .device-cell {
            color: #1565c0;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .price-cell {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .price-cell:hover {
            background: #e3f2fd !important;
        }
        
        .price-amount {
            font-weight: 700;
            color: #0d47a1;
            font-size: 1.4rem;
            margin-bottom: 5px;
        }
        
        .price-period {
            font-size: 1rem;
            color: #546e7a;
            margin-bottom: 12px;
        }
        
        /* Select Plan Button */
        .select-plan-btn {
            display: inline-block;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 5px;
            font-size: 0.95rem;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .select-plan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
            color: white;
        }
        
        /* Introduction Section */
        .intro-section {
            background: white;
            border-radius: 15px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border: 2px solid #e3f2fd;
            min-height: auto;
        }
        
        .intro-section h2 {
            color: #0d47a1;
            margin-bottom: 15px;
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .intro-section h2 i {
            color: #2196f3;
        }
        
        .intro-section p {
            margin-bottom: 15px;
            line-height: 1.7;
            color: #37474f;
            font-size: 1rem;
        }
        
        .service-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .service-card {
            background: #f8fdff;
            padding: 18px;
            border-radius: 10px;
            border-left: 5px solid #2196f3;
            transition: transform 0.3s ease;
            min-height: auto;
            height: auto;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 10px rgba(33, 150, 243, 0.1);
        }
        
        .service-card h3 {
            color: #1565c0;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .service-card h3 i {
            color: #2196f3;
        }
        
        .service-card p {
            margin: 0;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #546e7a;
        }
        
        /* ====== FOOTER STYLES - REDUCED HEIGHT BY 30% ====== */
        footer {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white; /* All text white */
            padding: 18px 0 12px; /* Reduced by 30% (was 25px 0 15px) */
            margin-top: auto;
        }
        
        .footer-content {
            text-align: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .footer-text {
            margin-bottom: 12px; /* Reduced */
        }
        
        .company-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 6px; /* Reduced */
            color: white; /* Changed to white */
        }
        
        .copyright {
            font-size: 0.95rem;
            color: white; /* Changed to white */
            margin-bottom: 12px; /* Reduced */
        }
        
        .footer-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 5px; /* Reduced gap */
            margin-top: 10px; /* Reduced */
        }
        
        .footer-links a {
            color: white; /* All links white */
            text-decoration: none;
            font-size: 1rem;
            font-weight: 600;
            transition: color 0.3s ease;
            padding: 0 8px; /* Padding for better spacing */
        }
        
        .footer-links a:hover {
            color: #bbdefb; /* Light blue on hover */
            text-decoration: underline;
        }
        
        .footer-separator {
            color: white; /* Separators white */
            font-weight: 400;
        }
        
        /* Remove separators on mobile */
        @media (max-width: 768px) {
            .footer-separator {
                display: none;
            }
            .footer-links {
                flex-direction: column;
                gap: 8px;
            }
            .footer-links a {
                padding: 0;
            }
        }
        
        /* ====== LOADING STATE ====== */
        .loading-state {
            text-align: center;
            padding: 30px;
            color: #1976d2;
            display: none;
        }
        
        .loading-state i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #2196f3;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-state {
            text-align: center;
            padding: 15px;
            background: #ffebee;
            color: #f44336;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #f44336;
            display: none;
        }
        
        /* ====== RESPONSIVE DESIGN ====== */
        @media (max-width: 1400px) {
            .pricing-table-container {
                width: 98%;
            }
            
            .container, .header-container, .footer-content {
                max-width: 1200px;
            }
        }
        
        @media (max-width: 1200px) {
            .pricing-table-container {
                width: 100%;
            }
            
            .storage-hero p {
                white-space: normal;
                font-size: 1.05rem;
            }
            
            .pricing-table th {
                font-size: 1.15rem;
                padding: 16px 18px;
            }
            
            .pricing-table td {
                padding: 18px 20px;
            }
            
            .plan-cell {
                font-size: 1.2rem;
            }
            
            .price-amount {
                font-size: 1.3rem;
            }
        }
        
        @media (max-width: 992px) {
            .storage-hero {
                padding: 14px 15px 10px; /* Reduced */
                min-height: 115px; /* Reduced */
            }
            
            .storage-hero h1 {
                font-size: 2rem; /* Smaller */
            }
            
            .intro-section,
            .pricing-section {
                padding: 22px;
            }
            
            .pricing-table th {
                font-size: 1.1rem;
                padding: 15px 16px;
            }
            
            .pricing-table td {
                padding: 16px 18px;
            }
            
            .plan-cell {
                font-size: 1.15rem;
            }
            
            .price-amount {
                font-size: 1.25rem;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .intro-section h2 {
                font-size: 1.8rem;
            }
        }
        
        @media (max-width: 768px) {
            .storage-hero {
                padding: 12px 15px 8px; /* Reduced */
                min-height: 100px; /* Reduced */
            }
            
            .storage-hero h1 {
                font-size: 1.8rem; /* Smaller */
                margin-bottom: 6px;
            }
            
            .storage-hero p {
                font-size: 0.95rem;
                line-height: 1.4;
                padding: 0 10px;
                white-space: normal;
            }
            
            .storage-content {
                padding: 12px 15px;
            }
            
            .intro-section,
            .pricing-section {
                padding: 18px;
                margin-bottom: 20px;
            }
            
            .section-title,
            .intro-section h2 {
                font-size: 1.7rem;
                margin-bottom: 12px;
            }
            
            .intro-section h2 {
                margin-bottom: 10px;
            }
            
            .pricing-table-container {
                width: 100%;
                overflow-x: auto;
            }
            
            .pricing-table {
                min-width: 600px;
            }
            
            .pricing-table th {
                font-size: 1.05rem;
                padding: 14px 15px;
            }
            
            .pricing-table td {
                padding: 15px 16px;
            }
            
            .plan-cell {
                font-size: 1.1rem;
            }
            
            .price-amount {
                font-size: 1.2rem;
            }
            
            .service-details {
                grid-template-columns: 1fr;
                gap: 18px;
                margin-top: 18px;
            }
            
            .service-card {
                padding: 16px;
            }
            
            .service-card h3 {
                font-size: 1.2rem;
            }
            
            .logo {
                font-size: 1.4rem;
            }
            
            .logo-image {
                height: 32px;
                width: 32px;
            }
            
            .home-nav {
                font-size: 1rem; /* Adjusted for mobile */
            }
        }
        
        @media (max-width: 480px) {
            .storage-hero {
                padding: 10px 10px 6px; /* Reduced */
                min-height: 85px; /* Reduced */
            }
            
            .storage-hero h1 {
                font-size: 1.6rem; /* Smaller */
                margin-bottom: 5px;
            }
            
            .storage-hero p {
                font-size: 0.9rem;
                margin-bottom: 0;
            }
            
            .intro-section,
            .pricing-section {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .pricing-table th {
                font-size: 1rem;
                padding: 12px 14px;
            }
            
            .pricing-table td {
                padding: 13px 14px;
            }
            
            .plan-cell {
                font-size: 1.05rem;
            }
            
            .price-amount {
                font-size: 1.15rem;
            }
            
            .service-details {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .service-card {
                padding: 14px;
            }
            
            .header-container {
                padding: 6px 15px; /* Reduced */
            }
            
            .logo {
                font-size: 1.3rem;
                gap: 8px;
            }
            
            .logo-image {
                height: 30px;
                width: 30px;
            }
            
            .home-nav {
                padding: 6px 16px;
                font-size: 0.95rem;
            }
            
            .section-title {
                font-size: 1.5rem;
                margin-bottom: 10px;
            }
            
            .intro-section h2 {
                font-size: 1.5rem;
                margin-bottom: 8px;
            }
            
            .gst-notice {
                padding: 8px;
                margin-bottom: 15px;
                font-size: 0.95rem;
            }
            
            footer {
                padding: 15px 0 10px; /* Further reduced for mobile */
            }
        }
        
        /* For very wide screens */
        @media (min-width: 1600px) {
            .pricing-table-container {
                width: 85%;
                max-width: 1200px;
            }
            
            .pricing-table th {
                font-size: 1.3rem;
                padding: 20px 25px;
            }
            
            .pricing-table td {
                padding: 22px 28px;
            }
            
            .plan-cell {
                font-size: 1.4rem;
            }
            
            .price-amount {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- ====== HEADER ====== -->
    <header>
        <div class="header-container">
            <div class="logo">
                <img src="images/logo1.jpg" alt="Odelya Locker Logo" class="logo-image" onerror="this.style.display='none'">
                <span>Locker</span>
            </div>
            
            <div class="nav-right">
                <a href="/index.html" class="home-nav">Home</a>
                <button class="hamburger" id="hamburger">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
        
        <!-- Dropdown Menu -->
        <div class="dropdown" id="dropdown">
            <a href="/user-details.html">
    <i class="fas fa-cogs"></i> User Details
</a>
            <a href="/security.html">
                <i class="fas fa-shield-alt"></i> Data Security
            </a>
            <a href="/privacy-policy.html">
                <i class="fas fa-user-shield"></i> Privacy Policy
            </a>
            <a href="/contact.html">
                <i class="fas fa-envelope"></i> Contact
            </a>
            <a href="/about.html">
                <i class="fas fa-users"></i> About
            </a>
        </div>
    </header>

    <!-- ====== MAIN CONTENT ====== -->
    <main>
        <!-- Loading State -->
        <div class="loading-state" id="loadingState">
            <i class="fas fa-spinner"></i>
            <p>Loading pricing plans...</p>
        </div>
        
        <!-- Error State -->
        <div class="error-state" id="errorState">
            <i class="fas fa-exclamation-triangle"></i>
            <p id="errorMessage">Unable to load pricing. Please refresh the page.</p>
        </div>
        
        <!-- Hero Section (Reduced height by 30%) -->
        <section class="storage-hero">
            <div class="container">
                <h1><i class="fas fa-cloud-upload-alt"></i> Secure Cloud Storage</h1>
                <p>Military-grade encrypted cloud storage with end-to-end protection for your personal and business data</p>
            </div>
        </section>
        
        <!-- Main Content -->
        <div class="storage-content">
            <!-- Pricing Section -->
            <section class="pricing-section">
                <h2 class="section-title"><i class="fas fa-tags"></i> Storage Plans & Pricing</h2>
                
                <div class="gst-notice" id="gstNotice">
                    <i class="fas fa-exclamation-circle"></i> All charges are inclusive of GST <span id="gstRateDisplay">18</span>%
                </div>
                
                <!-- Pricing Table -->
                <div class="pricing-table-container">
                    <table class="pricing-table">
                        <thead>
                            <tr>
                                <th>Plan (GB)</th>
                                <th>Device(s)</th>
                                <th class="price-header">Monthly Rate</th>
                                <th class="price-header">Yearly Rate</th>
                            </tr>
                        </thead>
                        <tbody id="pricing-table-body">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Introduction Section -->
            <section class="intro-section">
                <h2><i class="fas fa-shield-alt"></i> Your Data, Our Priority</h2>
                <p>Odelya Cloud Digital Locker provides secure, encrypted cloud storage solutions designed to protect your valuable data with military-grade security. Our services are fully compliant with Indian data protection laws including the IT Act, 2000 and DPDP Act, 2023.</p>
                
                <div class="service-details">
                    <div class="service-card">
                        <h3><i class="fas fa-lock"></i> Encryption</h3>
                        <p>All your data is encrypted using AES-256 encryption both in transit and at rest. Only you have access to your decryption keys.</p>
                    </div>
                    
                    <div class="service-card">
                        <h3><i class="fas fa-server"></i> 99.9% Uptime</h3>
                        <p>Our infrastructure ensures maximum availability with data centers located in Kolkata, India for optimal performance and compliance.</p>
                    </div>
                    
                    <div class="service-card">
                        <h3><i class="fas fa-user-shield"></i> Multi-User Access</h3>
                        <p>Share secure storage with team members or family with controlled access permissions and activity monitoring.</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- ====== FOOTER - REDUCED HEIGHT BY 30% ====== -->
    <footer>
        <div class="container footer-content">
            <div class="footer-text">
                <p class="company-name">A Product of Odelya Management Pvt Ltd</p>
                <p class="copyright">Â© 2025 OMPL | All rights reserved</p>
                
                <!-- Footer Links with | separators -->
                <div class="footer-links">
                    <a href="/index.html">Home</a>
                    <span class="footer-separator">|</span>
                    <a href="/security.html">Data Security</a>
                    <span class="footer-separator">|</span>
                    <a href="/terms.html">Terms</a>
                    <span class="footer-separator">|</span>
                    <a href="/privacy-policy.html">Privacy Policy</a>
                    <span class="footer-separator">|</span>
                    <a href="/contact.html">Contact</a>
                    <span class="footer-separator">|</span>
                    <a href="/about.html">About</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- ====== JAVASCRIPT ====== -->
    <script type="module">
        // ====== SECURE FIREBASE CONFIGURATION ======
        const apiKeyParts = ["AIzaSyA9Rg_P5jp3jHYP91LqYrO6fNVxSKn-", "NvA"];
        
        const firebaseConfig = {
            apiKey: apiKeyParts.join(''),
            authDomain: "odelya-user-data.firebaseapp.com",
            projectId: "odelya-user-data",
            storageBucket: "odelya-user-data.firebasestorage.app",
            messagingSenderId: "590231118790",
            appId: "1:590231118790:web:572c355c8826ad9c9148c7",
            measurementId: "G-9SWTR9V32R"
        };

        // ====== IMPORT FIREBASE ======
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ====== GLOBAL CONFIGURATION ======
        let pricingConfig = {
            plans: [
                { storage: 10, devices: 1 },
                { storage: 30, devices: 2 },
                { storage: 50, devices: 2 },
                { storage: 70, devices: 3 },
                { storage: 100, devices: 3 },
                { storage: 200, devices: 4 },
                { storage: 300, devices: 4 },
                { storage: 400, devices: 4 },
                { storage: 500, devices: 5 }
            ],
            
            normalDiscounts: {
                10: 5,     // 5% for 10GB
                30: 5,     // 5% for 30GB
                50: 10,    // 10% for 50GB
                70: 10,    // 10% for 70GB
                100: 15,   // 15% for 100GB
                200: 15,   // 15% for 200GB
                300: 20,   // 20% for 300GB
                400: 20,   // 20% for 400GB
                500: 25    // 25% for 500GB
            },
            
            // Default values (will be updated from Firebase)
            dataRate: 18,
            gstRate: 18,
            
            // Cache for pricing data
            cache: null,
            cacheTime: null
        };

        // ====== DOM ELEMENTS ======
        const elements = {
            loadingState: document.getElementById('loadingState'),
            errorState: document.getElementById('errorState'),
            errorMessage: document.getElementById('errorMessage'),
            pricingTableBody: document.getElementById('pricing-table-body'),
            gstRateDisplay: document.getElementById('gstRateDisplay'),
            gstNotice: document.getElementById('gstNotice'),
            hamburger: document.getElementById('hamburger'),
            dropdown: document.getElementById('dropdown')
        };

        // ====== UTILITY FUNCTIONS ======
        function showLoading(show) {
            elements.loadingState.style.display = show ? 'block' : 'none';
        }

        function showError(message, show) {
            if (show) {
                elements.errorMessage.textContent = message;
                elements.errorState.style.display = 'block';
            } else {
                elements.errorState.style.display = 'none';
            }
        }

        function formatCurrency(amount) {
            return 'INR ' + amount.toLocaleString('en-IN', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
        }

        // ====== FIREBASE INITIALIZATION ======
        async function initializeFirebase() {
            try {
                console.log('Initializing Firebase...');
                
                // Initialize Firebase
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                console.log('Firebase initialized successfully');
                return db;
            } catch (error) {
                console.error('Firebase initialization error:', error);
                showError('Failed to initialize pricing system. Using default pricing.', true);
                return null;
            }
        }

        // ====== PRICING MANAGEMENT ======
        async function loadPricingFromFirebase(db) {
            try {
                // Check cache first (5 minute cache)
                const now = Date.now();
                if (pricingConfig.cache && pricingConfig.cacheTime && 
                    (now - pricingConfig.cacheTime) < 300000) {
                    console.log('Using cached pricing data');
                    return pricingConfig.cache;
                }

                console.log('Loading pricing from Firebase...');
                const pricingRef = doc(db, "settings", "pricing");
                const docSnap = await getDoc(pricingRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    
                    // Validate data
                    if (typeof data.dataRate !== 'number' || data.dataRate <= 0) {
                        throw new Error('Invalid data rate in Firebase');
                    }
                    if (typeof data.gstRate !== 'number' || data.gstRate < 0 || data.gstRate > 100) {
                        throw new Error('Invalid GST rate in Firebase');
                    }
                    
                    pricingConfig.dataRate = data.dataRate;
                    pricingConfig.gstRate = data.gstRate;
                    
                    // Update cache
                    pricingConfig.cache = { dataRate: data.dataRate, gstRate: data.gstRate };
                    pricingConfig.cacheTime = now;
                    
                    console.log('Pricing loaded from Firebase:', { 
                        dataRate: data.dataRate, 
                        gstRate: data.gstRate 
                    });
                    
                    return { dataRate: data.dataRate, gstRate: data.gstRate };
                } else {
                    // Create default pricing
                    console.log('Creating default pricing in Firebase...');
                    await setDoc(pricingRef, {
                        dataRate: 18,
                        gstRate: 18,
                        lastUpdated: new Date().toISOString(),
                        note: "Data rate is INR per GB per month"
                    });
                    
                    pricingConfig.cache = { dataRate: 18, gstRate: 18 };
                    pricingConfig.cacheTime = now;
                    
                    return { dataRate: 18, gstRate: 18 };
                }
            } catch (error) {
                console.error('Error loading pricing:', error);
                showError('Unable to load current pricing. Using default rates.', true);
                return { dataRate: 18, gstRate: 18 };
            }
        }

        function calculatePrices() {
            const results = [];
            
            pricingConfig.plans.forEach(plan => {
                const calculatedMonthly = plan.storage * pricingConfig.dataRate;
                
                // Add GST
                const gstAmountMonthly = calculatedMonthly * (pricingConfig.gstRate / 100);
                const payableMonthly = Math.round(calculatedMonthly + gstAmountMonthly);
                
                // Yearly calculation
                const calculatedYearly = calculatedMonthly * 12;
                const normalDiscount = pricingConfig.normalDiscounts[plan.storage] || 0;
                
                // Apply normal discount for yearly plans
                let grossYearly = calculatedYearly;
                if (normalDiscount > 0) {
                    const normalDiscountAmount = calculatedYearly * (normalDiscount / 100);
                    grossYearly -= normalDiscountAmount;
                }
                
                // Add GST
                const gstAmountYearly = grossYearly * (pricingConfig.gstRate / 100);
                const payableYearly = Math.round(grossYearly + gstAmountYearly);
                
                results.push({
                    storage: plan.storage,
                    devices: plan.devices,
                    payableMonthly,
                    payableYearly,
                    normalDiscount
                });
            });
            
            return results;
        }

        function renderPricingTable() {
            try {
                const prices = calculatePrices();
                
                // Update GST display
                elements.gstRateDisplay.textContent = pricingConfig.gstRate;
                
                // Clear existing rows
                elements.pricingTableBody.innerHTML = '';
                
                // Add pricing rows
                prices.forEach(price => {
                    const row = document.createElement('tr');
                    
                    // Create links to user panel
                    const monthlyLink = `user-details.html?plan=${price.storage}GB Monthly&size=${price.storage}&price=${price.payableMonthly}&period=monthly`;
                    const yearlyLink = `user-details.html?plan=${price.storage}GB Yearly&size=${price.storage}&price=${price.payableYearly}&period=yearly`;
                    
                    row.innerHTML = `
                        <td class="plan-cell">${price.storage} GB</td>
                        <td class="device-cell">${price.devices} Device${price.devices > 1 ? 's' : ''}</td>
                        <td class="price-cell">
                            <div class="price-amount">${formatCurrency(price.payableMonthly)}</div>
                            <div class="price-period">per month</div>
                            <a href="${monthlyLink}" class="select-plan-btn">Select Plan</a>
                        </td>
                        <td class="price-cell">
                            <div class="price-amount">${formatCurrency(price.payableYearly)}</div>
                            <div class="price-period">per year</div>
                            <a href="${yearlyLink}" class="select-plan-btn">Select Plan</a>
                        </td>
                    `;
                    
                    elements.pricingTableBody.appendChild(row);
                });
                
                console.log('Pricing table rendered successfully');
                showError(false);
            } catch (error) {
                console.error('Error rendering pricing table:', error);
                showError('Unable to display pricing. Please try again.', true);
            }
        }

        // ====== REAL-TIME UPDATES ======
        function setupRealtimeUpdates(db) {
            try {
                const pricingRef = doc(db, "settings", "pricing");
                
                // Listen for pricing updates
                onSnapshot(pricingRef, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        const oldDataRate = pricingConfig.dataRate;
                        const oldGstRate = pricingConfig.gstRate;
                        
                        pricingConfig.dataRate = data.dataRate || 18;
                        pricingConfig.gstRate = data.gstRate || 18;
                        
                        // Update cache
                        pricingConfig.cache = { dataRate: pricingConfig.dataRate, gstRate: pricingConfig.gstRate };
                        pricingConfig.cacheTime = Date.now();
                        
                        // Only update if values changed
                        if (oldDataRate !== pricingConfig.dataRate || oldGstRate !== pricingConfig.gstRate) {
                            console.log('Pricing updated in real-time');
                            renderPricingTable();
                            
                            // Show notification to user
                            elements.gstNotice.innerHTML = 
                                `<i class="fas fa-sync-alt"></i> Prices updated! Data Rate: INR ${pricingConfig.dataRate}/GB, GST: ${pricingConfig.gstRate}%`;
                            elements.gstNotice.style.background = '#e8f5e9';
                            elements.gstNotice.style.color = '#2e7d32';
                            elements.gstNotice.style.borderLeftColor = '#4caf50';
                            
                            setTimeout(() => {
                                elements.gstNotice.innerHTML = 
                                    `<i class="fas fa-exclamation-circle"></i> All charges are inclusive of GST ${pricingConfig.gstRate}%`;
                                elements.gstNotice.style.background = '#ffebee';
                                elements.gstNotice.style.color = '#f44336';
                                elements.gstNotice.style.borderLeftColor = '#f44336';
                            }, 5000);
                        }
                    }
                }, (error) => {
                    console.error('Realtime update error:', error);
                });
                
                console.log('Real-time updates enabled');
            } catch (error) {
                console.error('Error setting up real-time updates:', error);
            }
        }

        // ====== DROPDOWN MENU ======
        function setupDropdownMenu() {
            if (!elements.hamburger || !elements.dropdown) return;
            
            elements.hamburger.addEventListener('click', function(e) {
                e.stopPropagation();
                elements.dropdown.classList.toggle('active');
                
                const icon = elements.hamburger.querySelector('i');
                if (elements.dropdown.classList.contains('active')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!elements.dropdown.contains(e.target) && !elements.hamburger.contains(e.target)) {
                    elements.dropdown.classList.remove('active');
                    const icon = elements.hamburger.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
            
            // Close dropdown when pressing Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && elements.dropdown.classList.contains('active')) {
                    elements.dropdown.classList.remove('active');
                    const icon = elements.hamburger.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
            
            // Close dropdown when clicking a link
            elements.dropdown.addEventListener('click', function(e) {
                if (e.target.tagName === 'A' || e.target.parentElement.tagName === 'A') {
                    elements.dropdown.classList.remove('active');
                    const icon = elements.hamburger.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
        }

        // ====== MAIN INITIALIZATION ======
        async function initializePage() {
            try {
                console.log('Starting page initialization...');
                showLoading(true);
                showError(false);
                
                // Setup dropdown menu
                setupDropdownMenu();
                
                // Initialize Firebase
                const db = await initializeFirebase();
                
                if (db) {
                    // Load pricing
                    await loadPricingFromFirebase(db);
                    
                    // Render pricing table
                    renderPricingTable();
                    
                    // Setup real-time updates
                    setupRealtimeUpdates(db);
                    
                    console.log('Page initialized successfully');
                } else {
                    // Use default pricing if Firebase fails
                    renderPricingTable();
                }
                
                showLoading(false);
                
            } catch (error) {
                console.error('Page initialization failed:', error);
                showError('Failed to initialize page. Please refresh.', true);
                showLoading(false);
                
                // Fallback: render with default pricing
                renderPricingTable();
                setupDropdownMenu();
            }
        }

        // ====== START APPLICATION ======
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            initializePage();
        }

    </script>
</body>
</html>
